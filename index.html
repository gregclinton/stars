<!--
    https://gregclinton.github.io/stars/
-->

<meta name="viewport" content="user-scalable=no,width=device-width" />

<body>
    <button id="allow" onclick="allow()">allow</button>
    <div>
        <div id="name"></div>
        <div  id="time"></div>
        <div id="tilt"></div>
        <table>
            <tbody id="stars"/>
        </table>
    </div>
</body>

<link href="main.css" rel="stylesheet"/>
<script src="julian.js"></script>
<script src="location.js"></script>
<script src="sidereal.js"></script>
<script src="precess.js"></script>
<script src="hipparcos.js"></script>
<script src="messier.js"></script>
<script src="stars.js"></script>

<script>
    let targetTime = false;
    let targetTilt = false;

    function put(name, value) {
        document.getElementById(name).innerHTML = value;
    }

    function explore(name, time, tilt) {
        targetTime = new Date(time);
        targetTilt = tilt;

        put('name', name);
        put('time', '');
    }

    const floor = Math.floor;

    window.addEventListener('deviceorientation', e => {
        if (targetTilt) {
            const tilt = Math.abs(targetTilt - e.beta);
            put('tilt', tilt > 1 ? floor(tilt) : tilt < 0.25 ? 0 : 1);
        }
    });

    setInterval(() => {
        if (targetTime) {
            const pad = n => (n < 10 ? '0' : '') + n;
            const t = floor(Math.abs(targetTime - new Date()) / 1000);
            const seconds = t % 60;
            const minutes = floor(t / 60) % 60;
            const hours = floor(t / 60 / 60);

            put('time', [hours, pad(minutes), pad(seconds)].join(':'));
        }
    }, 1000);
</script>