<!--
    https://gregclinton.github.io/stars/
-->

<div>
    <div id="name"></div>
    <div id="ra"></div>
    <div id="sidereal"></div>
    <div id="dec"></div>
    <div id="decScope"></div>
    <div onclick="explore('η Oph', '17:10:23', '-15 43')">η Oph, 17:10:23</div>
</div>

</body>

<link href="main.css" rel="stylesheet"/>
<script src="julian.js"></script>
<script src="longitude.js"></script>
<script src="sidereal.js"></script>
<script src="precess.js"></script>

<script>
    floor = Math.floor;

    function put(name, value) {
        document.getElementById(name).innerHTML = value;
    }

    function parseRa(s) {
        parts = s.split(':');
        return 15 * (1 * parts[0] + parts[1] / 60 + parts[2] / 3600);
    }

    function parseDec(s) {
        parts = s.split(' ');
        return 1 * parts[0] + parts[1] / 60;
    }

    const pad = n => (n < 10 ? '0' : '') + n;

    function formatRa(degrees) {
        const hours = floor(degrees / 15);
        const minutes = floor(((degrees / 15) % 1) * 60);
        const seconds = floor(((degrees / 60) % 1) * 3600);

        return hours + ':' + pad(minutes) + ':' + pad(seconds);
    }

    function formatDec(degrees) {
        const sign = degrees < 0 ? '-' : '';
        const absDegrees = Math.abs(degrees);
        const wholePart = floor(absDegrees);
        const minutes = floor(100 * (absDegrees - wholePart));

        return sign + pad(wholePart) + '.' + 15 * floor((0.1 + minutes / 15));
    }

    function explore(name, ra, dec) {
        enableDevice();
        const [raPrecessed, decPrecessed] = precess(parseRa(ra), parseDec(dec));

        put('name', name);
        put('ra', formatRa(raPrecessed));
        put('dec', formatDec(decPrecessed));
    }

    const interval = setInterval(() => {
        if (deviceEnabled) {
            window.addEventListener('deviceorientation', e => {
                const degrees = e.beta + (Math.abs(e.beta) < 5 ? 90 : 0);

                put('decScope', formatDec(degrees + ((degrees > longitude ? -90 : 0) - latitude)));
            });

            setInterval(() => {
                put('sidereal', formatRa(localSiderealDegrees()));
            }, 1000);

            clearInterval(interval);
        }
    }, 1000);
</script>