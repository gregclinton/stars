<!--
    https://gregclinton.github.io/stars/
-->

<div>
    <div id="name"></div>
    <div id="time"></div>
    <div id="incline"></div>
    <div onclick="explore('η Oph', '17:10:23', '-15 43')">η Oph, 17:10:23</div>
</div>

</body>

<link href="main.css" rel="stylesheet"/>
<script src="julian.js"></script>
<script src="longitude.js"></script>
<script src="sidereal.js"></script>
<script src="precess.js"></script>

<script>
    const floor = Math.floor;
    let transitTime = new Date();
    let targetIncline = 0;

    function put(name, value) {
        document.getElementById(name).innerHTML = value;
    }

    function parseRa(s) {
        parts = s.split(':');
        return 15 * (1 * parts[0] + parts[1] / 60 + parts[2] / 3600);
    }

    function parseDec(s) {
        parts = s.split(' ');
        return 1 * parts[0] + parts[1] / 60;
    }

    function explore(name, ra, dec) {
        enableDevice();

        const [raPrecessed, decPrecessed] = precess(parseRa(ra), parseDec(dec));

        transitTime = new Date();

        while (Math.abs(localSiderealDegrees(transitTime) - raPrecessed) > 1) {
            transitTime = new Date(transitTime.getTime() + 1000);
        }

        targetIncline = decPrecessed - latitude;
        put('name', name);
    }

    window.addEventListener('deviceorientation', e => {
        const degrees = e.beta + (Math.abs(e.beta) < 5 ? 90 : 0);

        put('incline', degrees + ((degrees > longitude ? -90 : 0) - latitude));
    });

    setInterval(() => {
        const pad = n => (n < 10 ? '0' : '') + n;
        const t = transitTime - new Date();
        const hours = Math.floor(t / 24 / 60 / 60 / 1000);
        const minutes = 2;
        const seconds = 2;

        put('time', hours + ':' + pad(minutes) + ':' + pad(seconds));
    }, 1000);
</script>