<!--
    https://gregclinton.github.io/stars/
-->

<meta name="viewport" content="user-scalable=no,width=device-width" />

<body>
    <div id="countdown" onclick="targetTime = false"></div>
    <button id="allow" onclick="run()">allow</button>
    <div>
        <span id="time"></span>
        <span id="tilt"></span>
        <table>
            <tbody id="stars"/>
        </table>
    </div>
</body>

<link href="main.css" rel="stylesheet"/>
<script src="julian.js"></script>
<script src="location.js"></script>
<script src="sidereal.js"></script>
<script src="precess.js"></script>
<script src="hipparcos.js"></script>
<script src="bayer.js"></script>
<script src="messier.js"></script>
<script src="sunset.js"></script>
<script src="stars.js"></script>

<script>
    const put = (name, value) => document.getElementById(name).innerHTML = value;
    let targetTime = false;

    window.addEventListener('deviceorientation', e => {
        put('tilt', (Math.round(e.gamma * 20) / 20).toFixed(2));
    });

    setInterval(() => {
        put('time', formatTime(new Date()));
        put('countdown', targetTime ? Math.abs(Math.floor((targetTime - new Date()) / 1000)) : '');
    }, 1000);

    function run() {
        document.getElementById('allow').remove();

        getGeoLocation((latitude, longitude) => {
            getSunset(latitude, longitude, sunset => {
                stars.add(latitude, longitude, sunset);
            });
        });
    }
</script>